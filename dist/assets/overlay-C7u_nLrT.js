import{r as p,d as E,l as I,j as e,i as s,a as k,S as A,A as O,C as T,G as L,f as D,e as M,g as B,R as G}from"./index-ChUB2kEe.js";function P(){const[a,d]=p.useState([]),x=p.useRef(0),g=p.useRef([]),w=p.useRef(!1),[y,C]=p.useState(()=>{try{const l=localStorage.getItem("achievementSettings");if(l)return JSON.parse(l).duration||6}catch{return 6}return 6}),[v,j]=p.useState(E),N=p.useRef(E),u=p.useRef(new Map);p.useEffect(()=>{N.current=v},[v]),p.useEffect(()=>{(()=>{try{const r=localStorage.getItem("raritySettings");if(s("debug_log",{message:"=== OVERLAY INITIALIZING ==="}),s("debug_log",{message:`localStorage raritySettings: ${r?"found":"not found"}`}),r){const i=JSON.parse(r);if(s("debug_log",{message:`Rarities enabled: ${i.enabled}`}),i.enabled){s("debug_log",{message:"Custom sounds configured:"});for(const o of["Common","Uncommon","Rare","Ultra Rare","Legendary"]){const t=i[o]?.soundPath;t&&s("debug_log",{message:`  ${o}: ${t}`})}}j(i)}else s("debug_log",{message:"No rarity settings found in localStorage, using defaults (enabled: false)"})}catch(r){s("debug_log",{message:`Failed to load rarity settings: ${r}`})}})()},[]),p.useEffect(()=>{const l=I("show-notification",o=>{const[t,n]=o.payload;console.log("[Overlay] Received notification:",t,n),g.current.push({type:t,...n}),R()}),r=I("rarity-settings-sync",o=>{const t=o.payload;if(s("debug_log",{message:"=== RARITY SETTINGS SYNCED FROM MAIN WINDOW ==="}),s("debug_log",{message:`Rarities enabled: ${t.enabled}`}),t.enabled){s("debug_log",{message:"Custom sounds configured:"});for(const n of["Common","Uncommon","Rare","Ultra Rare","Legendary"]){const c=t[n]?.soundPath;c&&s("debug_log",{message:`  ${n}: ${c}`})}}j(t),localStorage.setItem("raritySettings",JSON.stringify(t))}),i=()=>{try{const o=localStorage.getItem("achievementSettings");if(o){const t=JSON.parse(o);C(t.duration||6)}}catch{}};return window.addEventListener("storage",i),window.addEventListener("achievement-settings-updated",i),()=>{l.then(o=>o()),r.then(o=>o()),window.removeEventListener("storage",i),window.removeEventListener("achievement-settings-updated",i)}},[]);const h=async l=>{try{if(!(l.includes("\\")||l.includes("/")||/\.(png|jpg|jpeg|gif|bmp|svg|ico|webp)$/i.test(l)))return null;s("debug_log",{message:`Loading custom icon: ${l}`});const i=await s("read_audio_file",{filePath:l});s("debug_log",{message:`Read ${i.length} bytes from icon file`});const o=new Uint8Array(i);let t="image/png";const n=l.toLowerCase().split(".").pop();n==="jpg"||n==="jpeg"?t="image/jpeg":n==="gif"?t="image/gif":n==="bmp"?t="image/bmp":n==="svg"?t="image/svg+xml":n==="ico"?t="image/x-icon":n==="webp"&&(t="image/webp");const c=new Blob([o],{type:t}),m=URL.createObjectURL(c);return s("debug_log",{message:`‚úì Icon loaded successfully: ${m}`}),s("debug_log",{message:`MIME type: ${t}`}),m}catch(r){return s("debug_log",{message:`‚úó Failed to load icon: ${r}`}),null}},f=async(l,r)=>{try{if(u.current.has(l)){const $=u.current.get(l);return s("debug_log",{message:`Font already loaded: ${$}`}),$}s("debug_log",{message:`Loading custom font: ${l}`});const i=await s("read_audio_file",{filePath:l});s("debug_log",{message:`Read ${i.length} bytes from font file`});const o=new Uint8Array(i);let t="truetype";const n=l.toLowerCase().split(".").pop();n==="otf"?t="opentype":n==="woff"?t="woff":n==="woff2"&&(t="woff2");const c=new Blob([o]),m=URL.createObjectURL(c),b=`CustomFont-${r}-${Date.now()}`,_=new FontFace(b,`url(${m})`,{style:"normal",weight:"400"});return await _.load(),document.fonts.add(_),s("debug_log",{message:`‚úì Font loaded successfully: ${b}`}),u.current.set(l,b),b}catch(i){return s("debug_log",{message:`‚úó Failed to load font: ${i}`}),null}},R=async()=>{if(w.current||g.current.length===0)return;w.current=!0;const l=g.current.shift(),r={...l,id:x.current++,visible:!1};if(l.type==="achievement"){const o=N.current;if(o.enabled&&l.global_unlock_percentage!==void 0){const t=k(l.global_unlock_percentage),n=o[t].fontPath,c=o[t].icon;if(n){const m=await f(n,t);m&&(r.customFontFamily=m)}if(c){const m=await h(c);m&&(r.customIconUrl=m)}}}if(l.type==="achievement"){const o=N.current;if(s("debug_log",{message:"=== ACHIEVEMENT NOTIFICATION RECEIVED ==="}),s("debug_log",{message:`Rarity enabled: ${o.enabled}`}),s("debug_log",{message:`Global unlock %: ${l.global_unlock_percentage}`}),o.enabled&&l.global_unlock_percentage!==void 0){const t=k(l.global_unlock_percentage),n=o[t].soundPath;s("debug_log",{message:`Rarity: ${t}`}),s("debug_log",{message:`Custom sound path: ${n}`}),n?s("read_audio_file",{filePath:n}).then(c=>{s("debug_log",{message:`Read ${c.length} bytes from audio file`});const m=new Uint8Array(c);let b="audio/mpeg";const _=n.toLowerCase().split(".").pop();_==="wav"?b="audio/wav":_==="ogg"?b="audio/ogg":_==="flac"?b="audio/flac":_==="aac"&&(b="audio/aac");const $=new Blob([m],{type:b}),S=URL.createObjectURL($);s("debug_log",{message:`Created blob URL: ${S}`}),s("debug_log",{message:`MIME type: ${b}`});const F=new Audio(S);F.volume=1,F.play().then(()=>{s("debug_log",{message:"‚úì Custom sound played successfully"}),F.onended=()=>URL.revokeObjectURL(S)}).catch(U=>{s("debug_log",{message:`‚úó Failed to play custom sound: ${U.toString()}`}),URL.revokeObjectURL(S)})}).catch(c=>{s("debug_log",{message:`‚úó Failed to read audio file: ${c}`})}):s("debug_log",{message:"No custom sound configured - notification will be silent"})}else s("debug_log",{message:"Playing Windows notification sound (rarities disabled)"}),s("play_windows_notification_sound").catch(t=>{s("debug_log",{message:`‚úó Failed to play Windows sound: ${t}`})})}d(o=>[...o,r]),setTimeout(()=>{d(o=>o.map(t=>t.id===r.id?{...t,visible:!0}:t))},50);const i=l.type==="achievement"?y*1e3:3e3;setTimeout(()=>{d(o=>o.map(t=>t.id===r.id?{...t,visible:!1}:t)),setTimeout(()=>{d(o=>{const t=o.filter(n=>n.id!==r.id);return t.length===0&&g.current.length===0&&(console.log("[Overlay] All notifications done, hiding overlay"),M("overlay-notifications-done").catch(n=>{console.error("[Overlay] Failed to emit overlay-notifications-done:",n)})),t}),w.current=!1,g.current.length>0&&setTimeout(()=>R(),500)},300)},i)};return e.jsx("div",{className:"fixed inset-0 pointer-events-none",children:a.map(l=>e.jsx(W,{notification:l,duration:y,raritySettings:v},l.id))})}function W({notification:a,duration:d,raritySettings:x}){let g="top-right",w=1;if(a.type==="achievement"&&x.enabled&&a.global_unlock_percentage!==void 0){const N=k(a.global_unlock_percentage);g=x[N].position,w=x[N].scaling/100}const y={"top-left":"top-8 left-8","top-right":"top-8 right-8","bottom-left":"bottom-8 left-8","bottom-right":"bottom-8 right-8",center:"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},C=y[g]||y["top-right"];let v="translate-x-full opacity-0";g==="top-left"||g==="bottom-left"?v="-translate-x-full opacity-0":g==="center"&&(v="scale-50 opacity-0");const j=()=>{switch(a.type){case"achievement":return e.jsx(J,{gameName:a.game_name||"",achievementName:a.achievement_name||"",description:a.achievement_description||"",iconUrl:a.icon_url,duration:d,globalUnlockPercentage:a.global_unlock_percentage,raritySettings:x,customFontFamily:a.customFontFamily,customIconUrl:a.customIconUrl});case"game-detected":return e.jsx(V,{gameName:a.game_name||""});case"game-ended":return e.jsx(H,{gameName:a.game_name||""});case"backup-success":return e.jsx(Y,{gameName:a.game_name||"",filesCount:a.files_count||0,totalSize:a.total_size||""});case"backup-failed":return e.jsx(z,{gameName:a.game_name||"",error:a.error||""});default:return e.jsx(q,{title:a.title||"Notification",body:a.body||""})}};return e.jsx("div",{className:`fixed ${C} pointer-events-auto transform transition-all duration-300 ${a.visible?"translate-x-0 translate-y-0 scale-100 opacity-100":v}`,style:{willChange:"transform, opacity",transform:a.visible?`scale(${w})`:void 0},children:j()})}function J({gameName:a,achievementName:d,description:x,iconUrl:g,duration:w,globalUnlockPercentage:y,raritySettings:C,customFontFamily:v,customIconUrl:j}){const N=k(y),u=C.enabled,h=C[N],f=u?h.borderColor:"#F59E0B",R=u?h.backgroundColor:"#1a1f3a",l=u?h.backgroundOpacity/100:.9,r=u?h.titleColor:"#FDE68A",i=u?h.descriptionColor:"#D1D5DB",o=u&&h.glowEffect,t=u?h.glowColor:f,n=u?h.icon:"üèÜ",c=v||void 0,m=!!j;return e.jsxs("div",{className:"rounded-xl border-2 shadow-2xl backdrop-blur-sm p-6 min-w-[400px] max-w-[500px] relative",style:{backgroundColor:`${R}${Math.round(l*255).toString(16).padStart(2,"0")}`,borderColor:f,boxShadow:o?`0 0 30px ${t}, 0 0 60px ${t}40`:void 0,fontFamily:c},children:[o&&e.jsx("div",{className:"absolute inset-0 rounded-xl blur-xl",style:{background:`radial-gradient(circle at 50% 50%, ${t}40 0%, transparent 70%)`}}),e.jsxs("div",{className:"relative flex items-center gap-3 mb-4",children:[m?e.jsx("img",{src:j,alt:"Achievement Icon",className:"object-contain",style:{width:"48px",height:"48px",maxWidth:"48px",maxHeight:"48px"}}):e.jsx("span",{className:"text-3xl",children:n}),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg tracking-wide",style:{color:r},children:"ACHIEVEMENT UNLOCKED"}),y!==void 0&&e.jsxs("span",{className:"text-sm opacity-75",style:{color:r},children:["(",D(y),")"]}),u&&e.jsx("span",{className:"ml-auto px-2 py-0.5 rounded text-xs font-bold",style:{backgroundColor:`${f}30`,color:f,borderColor:f,border:"1px solid"},children:N})]})]}),e.jsxs("div",{className:"relative flex gap-4",children:[g&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:g,alt:d,className:"w-20 h-20 rounded-lg border-2",style:{borderColor:f+"30"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-xl mb-2",style:{color:r},children:d}),e.jsx("p",{className:"text-sm mb-3",style:{color:i},children:x}),e.jsx("p",{className:"text-xs",style:{color:i,opacity:.8},children:a})]})]}),e.jsx("div",{className:"relative mt-4 h-1 rounded-full overflow-hidden",style:{backgroundColor:`${f}30`},children:e.jsx("div",{className:"h-full rounded-full",style:{background:`linear-gradient(90deg, ${f} 0%, ${f}CC 100%)`,animation:`progress ${w}s linear forwards`}})}),e.jsx("style",{children:`
        @keyframes progress {
          0% { width: 0%; }
          100% { width: 100%; }
        }
      `})]})}function V({gameName:a}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-blue-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-blue-300 font-semibold text-sm",children:"Game Detected"}),e.jsx("p",{className:"text-white font-medium",children:a})]})]})})}function H({gameName:a}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-purple-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-purple-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-purple-300 font-semibold text-sm",children:"Game Ended"}),e.jsx("p",{className:"text-white font-medium",children:a})]})]})})}function Y({gameName:a,filesCount:d,totalSize:x}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-emerald-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-lg",children:e.jsx(T,{className:"w-5 h-5 text-emerald-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-emerald-300 font-semibold text-sm",children:"Backup Complete"}),e.jsx("p",{className:"text-white font-medium mb-1",children:a}),e.jsxs("p",{className:"text-gray-400 text-xs",children:[d," files ‚Ä¢ ",x]})]})]})})}function z({gameName:a,error:d}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-red-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px] max-w-[450px]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(O,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-300 font-semibold text-sm",children:"Backup Failed"}),e.jsx("p",{className:"text-white font-medium mb-1",children:a}),e.jsx("p",{className:"text-gray-400 text-xs",children:d})]})]})})}function q({title:a,body:d}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-gray-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-500/20 rounded-lg",children:e.jsx(A,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-300 font-semibold text-sm",children:a}),e.jsx("p",{className:"text-white text-sm",children:d})]})]})})}B.createRoot(document.getElementById("root")).render(e.jsx(G.StrictMode,{children:e.jsx(P,{})}));
