import{r as f,d as F,l as S,j as e,i as a,a as $,S as U,A,C as L,G as E,f as O,g as T,e as D,R as M}from"./index-BpsowiEp.js";function B(){const[o,c]=f.useState([]),b=f.useRef(0),g=f.useRef([]),y=f.useRef(!1),[p,j]=f.useState(F),x=f.useRef(F),N=f.useRef(new Map);f.useEffect(()=>{x.current=p},[p]),f.useEffect(()=>{(()=>{try{const i=localStorage.getItem("raritySettings");if(a("debug_log",{message:"=== OVERLAY INITIALIZING ==="}),a("debug_log",{message:`localStorage raritySettings: ${i?"found":"not found"}`}),i){const n=JSON.parse(i);if(a("debug_log",{message:`Rarities enabled: ${n.enabled}`}),n.enabled){a("debug_log",{message:"Custom sounds configured:"});for(const l of["Common","Uncommon","Rare","Ultra Rare","Legendary"]){const t=n[l]?.soundPath;t&&a("debug_log",{message:`  ${l}: ${t}`})}}j(n)}else a("debug_log",{message:"No rarity settings found in localStorage, using defaults (enabled: false)"})}catch(i){a("debug_log",{message:`Failed to load rarity settings: ${i}`})}})()},[]),f.useEffect(()=>{const s=S("show-notification",n=>{const[l,t]=n.payload;console.log("[Overlay] Received notification:",l,t),g.current.push({type:l,...t}),C()}),i=S("rarity-settings-sync",n=>{const l=n.payload;if(a("debug_log",{message:"=== RARITY SETTINGS SYNCED FROM MAIN WINDOW ==="}),a("debug_log",{message:`Rarities enabled: ${l.enabled}`}),l.enabled){a("debug_log",{message:"Custom sounds configured:"});for(const t of["Common","Uncommon","Rare","Ultra Rare","Legendary"]){const r=l[t]?.soundPath;r&&a("debug_log",{message:`  ${t}: ${r}`})}}j(l),localStorage.setItem("raritySettings",JSON.stringify(l))});return()=>{s.then(n=>n()),i.then(n=>n())}},[]);const v=async s=>{try{if(!(s.includes("\\")||s.includes("/")||/\.(png|jpg|jpeg|gif|bmp|svg|ico|webp)$/i.test(s)))return null;a("debug_log",{message:`Loading custom icon: ${s}`});const n=await a("read_audio_file",{filePath:s});a("debug_log",{message:`Read ${n.length} bytes from icon file`});const l=new Uint8Array(n);let t="image/png";const r=s.toLowerCase().split(".").pop();r==="jpg"||r==="jpeg"?t="image/jpeg":r==="gif"?t="image/gif":r==="bmp"?t="image/bmp":r==="svg"?t="image/svg+xml":r==="ico"?t="image/x-icon":r==="webp"&&(t="image/webp");const u=new Blob([l],{type:t}),d=URL.createObjectURL(u);return a("debug_log",{message:`‚úì Icon loaded successfully: ${d}`}),a("debug_log",{message:`MIME type: ${t}`}),d}catch(i){return a("debug_log",{message:`‚úó Failed to load icon: ${i}`}),null}},k=async(s,i)=>{try{if(N.current.has(s)){const w=N.current.get(s);return a("debug_log",{message:`Font already loaded: ${w}`}),w}a("debug_log",{message:`Loading custom font: ${s}`});const n=await a("read_audio_file",{filePath:s});a("debug_log",{message:`Read ${n.length} bytes from font file`});const l=new Uint8Array(n);let t="truetype";const r=s.toLowerCase().split(".").pop();r==="otf"?t="opentype":r==="woff"?t="woff":r==="woff2"&&(t="woff2");const u=new Blob([l]),d=URL.createObjectURL(u),m=`CustomFont-${i}-${Date.now()}`,h=new FontFace(m,`url(${d})`,{style:"normal",weight:"400"});return await h.load(),document.fonts.add(h),a("debug_log",{message:`‚úì Font loaded successfully: ${m}`}),N.current.set(s,m),m}catch(n){return a("debug_log",{message:`‚úó Failed to load font: ${n}`}),null}},C=async()=>{if(y.current||g.current.length===0)return;y.current=!0;const s=g.current.shift(),i={...s,id:b.current++,visible:!1};if(s.type==="achievement"){const l=x.current;if(l.enabled&&s.global_unlock_percentage!==void 0){const t=$(s.global_unlock_percentage),r=l[t].fontPath,u=l[t].icon;if(r){const d=await k(r,t);d&&(i.customFontFamily=d)}if(u){const d=await v(u);d&&(i.customIconUrl=d)}}}if(s.type==="achievement"){const l=x.current;if(a("debug_log",{message:"=== ACHIEVEMENT NOTIFICATION RECEIVED ==="}),a("debug_log",{message:`Rarity enabled: ${l.enabled}`}),a("debug_log",{message:`Global unlock %: ${s.global_unlock_percentage}`}),l.enabled&&s.global_unlock_percentage!==void 0){const t=$(s.global_unlock_percentage),r=l[t].soundPath;a("debug_log",{message:`Rarity: ${t}`}),a("debug_log",{message:`Custom sound path: ${r}`}),r?a("read_audio_file",{filePath:r}).then(u=>{a("debug_log",{message:`Read ${u.length} bytes from audio file`});const d=new Uint8Array(u);let m="audio/mpeg";const h=r.toLowerCase().split(".").pop();h==="wav"?m="audio/wav":h==="ogg"?m="audio/ogg":h==="flac"?m="audio/flac":h==="aac"&&(m="audio/aac");const w=new Blob([d],{type:m}),_=URL.createObjectURL(w);a("debug_log",{message:`Created blob URL: ${_}`}),a("debug_log",{message:`MIME type: ${m}`});const R=new Audio(_);R.volume=1,R.play().then(()=>{a("debug_log",{message:"‚úì Custom sound played successfully"}),R.onended=()=>URL.revokeObjectURL(_)}).catch(I=>{a("debug_log",{message:`‚úó Failed to play custom sound: ${I.toString()}`}),URL.revokeObjectURL(_)})}).catch(u=>{a("debug_log",{message:`‚úó Failed to read audio file: ${u}`})}):a("debug_log",{message:"No custom sound configured - notification will be silent"})}else a("debug_log",{message:"Playing Windows notification sound (rarities disabled)"}),a("play_windows_notification_sound").catch(t=>{a("debug_log",{message:`‚úó Failed to play Windows sound: ${t}`})})}c(l=>[...l,i]),setTimeout(()=>{c(l=>l.map(t=>t.id===i.id?{...t,visible:!0}:t))},50);const n=s.type==="achievement"?(s.duration_seconds||6)*1e3:3e3;setTimeout(()=>{c(l=>l.map(t=>t.id===i.id?{...t,visible:!1}:t)),setTimeout(()=>{c(l=>{const t=l.filter(r=>r.id!==i.id);return t.length===0&&g.current.length===0&&(console.log("[Overlay] All notifications done, hiding overlay"),T("overlay-notifications-done").catch(r=>{console.error("[Overlay] Failed to emit overlay-notifications-done:",r)})),t}),y.current=!1,g.current.length>0&&setTimeout(()=>C(),500)},300)},n)};return e.jsx("div",{className:"fixed inset-0 pointer-events-none",children:o.map(s=>e.jsx(G,{notification:s,duration:s.duration_seconds||6,raritySettings:p},s.id))})}function G({notification:o,duration:c,raritySettings:b}){let g="top-right",y=1;if(o.type==="achievement"&&b.enabled&&o.global_unlock_percentage!==void 0){const v=$(o.global_unlock_percentage);g=b[v].position,y=b[v].scaling/100}const p={"top-left":"top-8 left-8","top-right":"top-8 right-8","bottom-left":"bottom-8 left-8","bottom-right":"bottom-8 right-8",center:"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},j=p[g]||p["top-right"];let x="translate-x-full opacity-0";g==="top-left"||g==="bottom-left"?x="-translate-x-full opacity-0":g==="center"&&(x="scale-50 opacity-0");const N=()=>{switch(o.type){case"achievement":return e.jsx(W,{gameName:o.game_name||"",achievementName:o.achievement_name||"",description:o.achievement_description||"",iconUrl:o.icon_url,duration:c,globalUnlockPercentage:o.global_unlock_percentage,raritySettings:b,customFontFamily:o.customFontFamily,customIconUrl:o.customIconUrl});case"game-detected":return e.jsx(P,{gameName:o.game_name||""});case"game-ended":return e.jsx(V,{gameName:o.game_name||""});case"backup-success":return e.jsx(H,{gameName:o.game_name||"",filesCount:o.files_count||0,totalSize:o.total_size||""});case"backup-failed":return e.jsx(Y,{gameName:o.game_name||"",error:o.error||""});default:return e.jsx(z,{title:o.title||"Notification",body:o.body||""})}};return e.jsx("div",{className:`fixed ${j} pointer-events-auto transform transition-all duration-300 ${o.visible?"translate-x-0 translate-y-0 scale-100 opacity-100":x}`,style:{willChange:"transform, opacity",transform:o.visible?`scale(${y})`:void 0},children:N()})}function W({gameName:o,achievementName:c,description:b,iconUrl:g,duration:y,globalUnlockPercentage:p,raritySettings:j,customFontFamily:x,customIconUrl:N}){const[v,k]=f.useState(0);f.useEffect(()=>{const R=setTimeout(()=>{k(100)},50);return()=>clearTimeout(R)},[]);const C=$(p),s=j.enabled,i=j[C],n=s?i.borderColor:"#F59E0B",l=s?i.backgroundColor:"#1a1f3a",t=s?i.backgroundOpacity/100:.9,r=s?i.titleColor:"#FDE68A",u=s?i.descriptionColor:"#D1D5DB",d=s&&i.glowEffect,m=s?i.glowColor:n,h=s?i.icon:"üèÜ",w=x||void 0,_=!!N;return e.jsxs("div",{className:"rounded-xl border-2 shadow-2xl backdrop-blur-sm p-6 min-w-[400px] max-w-[500px] relative",style:{backgroundColor:`${l}${Math.round(t*255).toString(16).padStart(2,"0")}`,borderColor:n,boxShadow:d?`0 0 30px ${m}, 0 0 60px ${m}40`:void 0,fontFamily:w},children:[d&&e.jsx("div",{className:"absolute inset-0 rounded-xl blur-xl",style:{background:`radial-gradient(circle at 50% 50%, ${m}40 0%, transparent 70%)`}}),e.jsxs("div",{className:"relative flex items-center gap-3 mb-4",children:[_?e.jsx("img",{src:N,alt:"Achievement Icon",className:"object-contain",style:{width:"48px",height:"48px",maxWidth:"48px",maxHeight:"48px"}}):e.jsx("span",{className:"text-3xl",children:h}),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg tracking-wide",style:{color:r},children:"ACHIEVEMENT UNLOCKED"}),p!==void 0&&e.jsxs("span",{className:"text-sm opacity-75",style:{color:r},children:["(",O(p),")"]}),s&&e.jsx("span",{className:"ml-auto px-2 py-0.5 rounded text-xs font-bold",style:{backgroundColor:`${n}30`,color:n,borderColor:n,border:"1px solid"},children:C})]})]}),e.jsxs("div",{className:"relative flex gap-4",children:[g&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:g,alt:c,className:"w-20 h-20 rounded-lg border-2",style:{borderColor:n+"30"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-xl mb-2",style:{color:r},children:c}),e.jsx("p",{className:"text-sm mb-3",style:{color:u},children:b}),e.jsx("p",{className:"text-xs",style:{color:u,opacity:.8},children:o})]})]}),e.jsx("div",{className:"relative mt-4 h-1 rounded-full overflow-hidden",style:{backgroundColor:`${n}30`},children:e.jsx("div",{className:"h-full rounded-full",style:{background:`linear-gradient(90deg, ${n} 0%, ${n}CC 100%)`,width:`${v}%`,transition:`width ${y}s linear`}})})]})}function P({gameName:o}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-blue-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(E,{className:"w-5 h-5 text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-blue-300 font-semibold text-sm",children:"Game Detected"}),e.jsx("p",{className:"text-white font-medium",children:o})]})]})})}function V({gameName:o}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-purple-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/20 rounded-lg",children:e.jsx(E,{className:"w-5 h-5 text-purple-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-purple-300 font-semibold text-sm",children:"Game Ended"}),e.jsx("p",{className:"text-white font-medium",children:o})]})]})})}function H({gameName:o,filesCount:c,totalSize:b}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-emerald-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-emerald-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-emerald-300 font-semibold text-sm",children:"Backup Complete"}),e.jsx("p",{className:"text-white font-medium mb-1",children:o}),e.jsxs("p",{className:"text-gray-400 text-xs",children:[c," files ‚Ä¢ ",b]})]})]})})}function Y({gameName:o,error:c}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-red-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px] max-w-[450px]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(A,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-300 font-semibold text-sm",children:"Backup Failed"}),e.jsx("p",{className:"text-white font-medium mb-1",children:o}),e.jsx("p",{className:"text-gray-400 text-xs",children:c})]})]})})}function z({title:o,body:c}){return e.jsx("div",{className:"bg-gradient-to-br from-[#1a1f3a] to-[#2a2f4a] rounded-xl border-2 border-gray-500/50 shadow-2xl backdrop-blur-sm p-5 min-w-[350px]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-500/20 rounded-lg",children:e.jsx(U,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-300 font-semibold text-sm",children:o}),e.jsx("p",{className:"text-white text-sm",children:c})]})]})})}D.createRoot(document.getElementById("root")).render(e.jsx(M.StrictMode,{children:e.jsx(B,{})}));
